<!doctype html>
<html lang="en">

<head>
    <!-- meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Dennis Eum">

    <!-- css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!-- icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">

    <!-- title -->
    <title>Citecreator</title>
</head>

<body>
    <!-- container -->
    <div class="container-md">
        <div class="d-flex my-3">
            <h1>Citecreator</h1>
            <div class="mt-1 ms-3">
                <button type="button" name="reset" class="btn btn-dark shadow-sm">reset</button>
            </div>
        </div>
        <form class="needs-validation" autocomplete="off" novalidate>
            <label class="form-label">Information</label>
            <div class="row">
                <div class="col col-md-3">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="author" placeholder="author" required>
                        <label>Author</label>
                    </div>
                    <div class=" position-relative float-end bg-white ps-3" style="bottom: 3rem; right: 0.65rem;">

                    </div>
                </div>
                <div class="col-md">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="quals" placeholder="quals" required>
                        <label>Qualifications</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col col-md-3">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="title" placeholder="title" required>
                        <label>Title</label>
                    </div>
                </div>
                <div class="col col-md-3">
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" name="date" required>
                        <label>Date</label>
                    </div>
                </div>
                <div class="col-md">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="link" placeholder="link" required>
                        <label>Link</label>
                    </div>
                </div>
            </div>
        </form>
        <div class="mt-3">
            <label class="form-label">Citation</label>
            <div class="form-check position-relative float-end" style="top: 6rem; right: 0.75rem;">
                <input class="form-check-input shadow-sm" type="checkbox" id="flexCheckDefault">
                <label class="form-check-label" for="flexCheckDefault">
                    et al.
                </label>
            </div>
            <textarea data-copy class="form-control" rows="5" style="resize:none;font-size:18px;" disabled></textarea>
            <div class="text-end">
                <button type="button" data-copy class="btn btn-light shadow-sm position-relative"
                    style="bottom: 3rem; right: 0.65rem;">copy</button>
            </div>
        </div>
        <div class="d-grid">
            <button type="submit" class="btn btn-dark btn-lg shadow-sm">Submit entry</button>
        </div>
    </div>

    <!-- footer -->
    <footer class="text-center py-3">
        <p>&copy; <span id="year"></span> Dennis Eum</p>
    </footer>

    <!-- scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"
        integrity="sha256-XfzdiC+S1keia+s9l07y7ye5a874sBq67zK4u7LTjvk=" crossorigin="anonymous"></script>
    <script>
        $(function () {
            feather.replace();
            const now = new Date();
            $('#year').text(now.getFullYear());
            $('button[name="reset"]').click(function () {
                $('form').trigger('reset');
                $('textarea[data-copy]').val('');
            });
            $('input').keyup(function () {
                let author = $('input[name="author"]').val();
                let quals = $('input[name="quals"]').val();
                let date = new Date($('input[name="date"]').val());
                let title = $('input[name="title"]').val();
                let link = $('input[name="link"]').val();
                if ($('input[type="checkbox"]').is(':checked')) {
                    $('textarea[data-copy]').val(`${author.split(' ').pop()} et al. ${date.getFullYear().toString().slice(-2)} (${author}: ${quals}. "${title}," ${convertDate(date)}, ${link}. DOA: ${convertDate(now)}) DSE`);
                } else {
                    $('textarea[data-copy]').val(`${author.split(' ').pop()} ${date.getFullYear().toString().slice(-2)} (${author}: ${quals}. "${title}," ${convertDate(date)}, ${link}. DOA: ${convertDate(now)}) DSE`);
                }
            });
            $('input[type="checkbox"]').change(function () {
                let author = $('input[name="author"]').val();
                let quals = $('input[name="quals"]').val();
                let date = new Date($('input[name="date"]').val());
                let title = $('input[name="title"]').val();
                let link = $('input[name="link"]').val();
                if ($('input[type="checkbox"]').is(':checked')) {
                    $('textarea[data-copy]').val(`${author.split(' ').pop()} et al. ${date.getFullYear().toString().slice(-2)} (${author}: ${quals}. "${title}," ${convertDate(date)}, ${link}. DOA: ${convertDate(now)}) DSE`);
                } else {
                    $('textarea[data-copy]').val(`${author.split(' ').pop()} ${date.getFullYear().toString().slice(-2)} (${author}: ${quals}. "${title}," ${convertDate(date)}, ${link}. DOA: ${convertDate(now)}) DSE`);
                }
            });
            $('button[data-copy]').click(function () {
                navigator.clipboard.writeText($('textarea[data-copy]').val()).then(function () {
                    $('button[data-copy]').text('copied');
                    setTimeout(function () {
                        $('button[data-copy]').text('copy');
                    }, 1500);
                });
            });
            $('button[type="submit"]').click(function () {
                $('form').submit();
            });
            $('form').submit(function (event) {
                event.preventDefault();
                if (!this.checkValidity()) {
                    event.stopPropagation();
                } else {
                    let author = $('input[name="author"]').val();
                    let quals = $('input[name="quals"]').val();
                    let date = new Date($('input[name="date"]').val());
                    let title = $('input[name="title"]').val();
                    let link = $('input[name="link"]').val();
                    $('button[type="submit"]').html('Submitting...&nbsp;&nbsp;&nbsp;<div class="spinner-border align-middle" role="status"> <span class="visually-hidden">Loading...</span> </div>');
                    fetch('https://script.google.com/macros/s/AKfycbxukXWWDhbh2X6KLZMyzBFkwgpRdJCUWKSqNAqPVnQfzbItk8MEzsez8g/exec', {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            author: author,
                            date: convertDate(date),
                            title: title,
                            link: link,
                            name: 'Dennis',
                            today: convertDate(now),
                            checked: $('input[type="checkbox"]').is(':checked')
                        })
                    }).then(response => {
                        $('button[type="submit"]').html('Submit entry');
                    }).catch(error => console.log(error));
                }
                this.classList.add('was-validated');
            });
        });
        function convertDate(input) {
            return `${input.getMonth()}/${input.getDay()}/${input.getFullYear()}`
        }
    </script>
</body>

</html>